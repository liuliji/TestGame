# Websocket.Umbrella


在Phoenix框架中，对于socket的支持，整个流程可以看做是 `socket连接接收消息` -> `房间处理消息` -> `返回给socket消息`

其实，在考虑到断线的情况之后（断线就是socket断开连接，所以这时候socket的状态就丢失了），整个流程应该是： `socket连接接收消息` -> `将消息传递给内部房间逻辑服务` -> `内部房间服务处理消息` -> `将消息发给socket房间` -> `socket房间将消息广播给用户` 如果出现了某用户断线的情况，该用户的socket虽然断开了连接，这时 该用户不会再发出消息了，但是还是能正常的处理接收消息，不影响整个游戏的进行。


其实，上面的流程当中，到底是用户socket的接收的消息，还是房间channel接收的消息？ 其实上面是有一点模糊的。最细致的服务器游戏流程应该是： `socket连接 接收消息` -> `传递给内部用户处理` -> `传递给内部房间广播还是单发` -> `内部用户处理消息` -> `传递给socket当前的用户信息` -> `socket传递消息给客户端` 整个链条就是：**socket - inner_user - inner_room - inner_user - socket**。 这样分工明确，但是真正这样设计的话又有点繁琐，所以用的最多的就是第二种。


> 我发现，只要弄清楚了整个通信流程，每个上下文变量中应该存储什么值也就确定了。
